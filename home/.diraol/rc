#!/bin/bash

# If we have already lodade my own configs, we do not need to do it again
# if [[ "${DIRAOL_RC_LOADED:-FALSE}" == "TRUE" ]]; then
#     exit 0
# fi

# Loading most personalized env vars
if [[ -f "${HOME}/.diraol/variables" ]]; then
        source "${HOME}/.diraol/variables"
fi

# Loading protected data
if [[ -f "${HOME}/.diraol/protected_data" ]]; then
        source "${HOME}/.diraol/protected_data"
fi

# Setting path
while IFS= read -r DIR; do
        if [[ -d "${DIR}" && ":${PATH}:" != *":${DIR}:"* ]]; then
                export PATH="${DIR}:${PATH}"
        fi
done < <( cat <<-EOF
/usr/local/go/bin
/snap/bin
${GOPATH}/bin
${HOME}/.pyenv/shims
${HOME}/.local/bin
${HOME}/tools/bin
EOF
)

# Config for exporting SSH_AUTH_SOCK
# Ref: https://eklitzke.org/using-ssh-agent-and-ed25519-keys-on-gnome
# Check if it is really needed.
eval $(systemctl --user show-environment | grep SSH_AUTH_SOCK)
export SSH_AUTH_SOCK

# Sourcing other config files
for F in $(find ${HOME}/.diraol/ -name '_*'); do
  source "$F"
done

if [[ -d "${HOME}/.rbenv/bin" ]]; then
    export PATH="${HOME}/.rbenv/bin:${PATH}"
    eval "$(rbenv init -)"
fi

if [[ -s "${NVM_DIR}/nvm.sh" ]]; then
        . "$NVM_DIR/nvm.sh"  # This loads nvm

        if [[ -s "${NVM_DIR}/bash_completion" && "${SHELL}" == "/bin/bash" ]]; then
                . "${NVM_DIR}/bash_completion"  # This loads nvm bash_completion
        fi
fi

# Setting env var to state we have already lodade this config file
export DIRAOL_RC_LOADED="TRUE"

source "${HOME}/.diraol/_initial_load"
